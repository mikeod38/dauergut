<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />




<title>Figure 2</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/flatly.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script src="site_libs/navigation-1.1/codefolding.js"></script>
<link href="site_libs/highlightjs-1.1/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-1.1/highlight.js"></script>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs && document.readyState && document.readyState === "complete") {
   window.setTimeout(function() {
      hljs.initHighlighting();
   }, 0);
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>


</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 60px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 65px;
  margin-top: -65px;
}

.section h2 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h3 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h4 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h5 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h6 {
  padding-top: 65px;
  margin-top: -65px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>


<div class="container-fluid main-container">

<!-- tabsets -->
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
</style>
<script>
$(document).ready(function () {
  window.initializeCodeFolding("hide" === "show");
});
</script>






<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Rictor/TORC2 mediates gut-to-brain signaling in the regulation of phenotypic plasticity in C.elegans</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">home</a>
</li>
<li>
  <a href="Figure_1.html">Figure 1</a>
</li>
<li>
  <a href="Figure_2.html">Figure 2</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">

<div class="btn-group pull-right">
<button type="button" class="btn btn-default btn-xs dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu" style="min-width: 50px;">
<li><a id="rmd-show-all-code" href="#">Show All Code</a></li>
<li><a id="rmd-hide-all-code" href="#">Hide All Code</a></li>
</ul>
</div>



<h1 class="title toc-ignore">Figure 2</h1>

</div>


<div id="figure-2-intestinal-mtorc2-regulates-sensory-neuron-state" class="section level1 tabset">
<h1><strong>Figure 2 Intestinal mTORC2 regulates sensory neuron state</strong></h1>
<div id="a" class="section level2">
<h2>2A</h2>
<pre class="r"><code>strains&lt;-c(&quot;N2&quot;,&quot;mg360&quot;,&quot;ft7&quot;,&quot;ft7_ges1resc&quot;)
dates&lt;-c(&quot;10_22_16&quot;, &quot;11_9_16&quot;, &quot;11_23_16&quot;) #dropped &quot;12_6_16&quot; due to missingness
d7GFP&lt;-read.csv(file.path(pathname,&quot;extdata/2A_3A_daf7GFP.csv&quot;)) %&gt;% filter(mean!=4095 &amp; genotype %in% strains &amp; date %in% dates &amp; temp == &quot;27&quot; &amp; food == &quot;OP50&quot;) %&gt;% mutate(genotype = factor(genotype, levels=strains), ID = as.character(ID)) %&gt;%
  separate(ID, c(&quot;ID.A&quot;, &quot;ID.B&quot;), sep = &quot;:&quot;, extra = &quot;drop&quot;) %&gt;% 
  mutate(genoID = paste(date, genotype, ID.A, sep = &quot;:&quot;), cell.norm = mean) #genoID is animal, 2 cells per animal measured.

df &lt;- d7GFP %&gt;% group_by(date, genotype, genoID) %&gt;% summarise(cell.norm = mean(cell.norm)) # take mean of each worm

### Linear models ###

log.tran&lt;-lsmeans::make.tran(type=&quot;genlog&quot;, param = c(0,10))
lmm2&lt;-with(log.tran, lmer(linkfun(cell.norm) ~ genotype + (1|date) + (1|genotype:date), data = df))
lm &lt;- with(log.tran, lm(linkfun(cell.norm) ~ genotype, data = df))
stanlmer &lt;- with(log.tran, rstanarm::stan_lmer(linkfun(cell.norm) ~ genotype + (1|date) + (1:genotype:date), 
                                               data = df, 
                                               chains = 3, 
                                               cores =4, 
                                               seed = 2000,
                                               iter=6000,
                                               control = list(adapt_delta=0.99)))

### compare ft7 to rescue H0, ft7 = ft7_resc ###
rescue.test &lt;- d7GFP %&gt;% subset(genotype %in% c(&quot;ft7&quot;, &quot;ft7_ges1resc&quot;)) %$% with(log.tran, t.test(linkfun(cell.norm) ~ genotype))
rescue.p &lt;- data.frame(p.value = rescue.test$p.value) %&gt;% dauergut::prange()

#H0, all genotypes = N2
contrasts&lt;-dauergut::dunnett_contrasts(lm, ref.index = 1, &quot;genotype&quot;)</code></pre>
<pre><code>## [1] &quot;interaction term not indicated&quot;</code></pre>
<pre class="r"><code>mixed &lt;- stanlmer %&gt;% getStan_CIs(type = &quot;log&quot;, base = 10)

plot.contrasts&lt;-c(&quot;&quot;,contrasts$prange[1:2],&quot;&quot;)
plot.contrasts.2 &lt;- c(&quot;&quot;, &quot;&quot;, &quot;&quot;, rescue.p$prange)

p2&lt;-dauergut::plot_CIs(df=df, title=&#39;daf-7 expression in ASI at 27ยบ is
controlled by intestinal rict-1&#39;, plot.contrasts=plot.contrasts, plot.contrasts.2 = plot.contrasts.2, ypos = 4700, offset = 0, type = &quot;GFP&quot;)

img.path &lt;- file.path(pathname,&quot;figures/2A_daf7GFP.png&quot;)</code></pre>
<div style="float: left; width: 50%;">
<p><img src="figures/2A_daf7GFP.png" width="200" /></p>
</div>
<div style="float: right; width: 50%;">
<pre class="r"><code>p2</code></pre>
<p><img src="Figure_2_files/figure-html/unnamed-chunk-2-1.png" width="672" /></p>
</div>
<div class="wrapper">
<p class="left">
</p>
</div>
<p>2A. Intesinal <em>rict-1</em> regulates daf7GFP levels in ASI neurons. L1 animals were grown 18hrs post egg lay at 27ยบ. Daf-7::GFP fluorescence quantification shows decreased expression in <em>rict-1</em> mutants. Intestinal expression of <em>rict-1</em> using the intestinal <em>ges-1</em> promoter rescues daf-7::GFP expression. Box and scatter plot show raw data. Bayesian 90% (grey) and 50% (red) credible intervals are shown on the right (see methods). For <em>rict-1(mg360)</em> and <em>rict-1(ft7)</em>, *** and ** compared to N2, respectively. For <em>ges-1</em> rescue, *** compared to <em>rict-1(ft7)</em>. n=3 independent experiments.</p>
<pre class="r"><code>knitr::kable(contrasts, caption=&quot;Pairwise comparisons from mixed-effects model (Tukey)&quot;)</code></pre>
<table>
<caption>Pairwise comparisons from mixed-effects model (Tukey)</caption>
<thead>
<tr class="header">
<th align="left">contrast</th>
<th align="right">estimate</th>
<th align="right">SE</th>
<th align="right">df</th>
<th align="right">t.ratio</th>
<th align="right">p.value</th>
<th align="left">prange</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">mg360 - N2</td>
<td align="right">-0.3044202</td>
<td align="right">0.0444226</td>
<td align="right">122</td>
<td align="right">-6.8528183</td>
<td align="right">0.0000000</td>
<td align="left">***</td>
</tr>
<tr class="even">
<td align="left">ft7 - N2</td>
<td align="right">-0.1504361</td>
<td align="right">0.0447683</td>
<td align="right">122</td>
<td align="right">-3.3603231</td>
<td align="right">0.0030194</td>
<td align="left">**</td>
</tr>
<tr class="odd">
<td align="left">ft7_ges1resc - N2</td>
<td align="right">0.0151539</td>
<td align="right">0.0463634</td>
<td align="right">122</td>
<td align="right">0.3268511</td>
<td align="right">0.9772203</td>
<td align="left">p~0.98</td>
</tr>
</tbody>
</table>
<pre class="r"><code>knitr::kable(mixed[,c(6,1:5)], caption = &quot;Bayesian credible intervals&quot;)</code></pre>
<table>
<caption>Bayesian credible intervals</caption>
<thead>
<tr class="header">
<th align="left">genotype</th>
<th align="right">mean</th>
<th align="right">lower.CL</th>
<th align="right">upper.CL</th>
<th align="right">lower.25</th>
<th align="right">upper.75</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">N2</td>
<td align="right">2275.739</td>
<td align="right">1761.2710</td>
<td align="right">2888.819</td>
<td align="right">2014.048</td>
<td align="right">2569.422</td>
</tr>
<tr class="even">
<td align="left">mg360</td>
<td align="right">1136.878</td>
<td align="right">935.5569</td>
<td align="right">1379.605</td>
<td align="right">1014.621</td>
<td align="right">1276.525</td>
</tr>
<tr class="odd">
<td align="left">ft7</td>
<td align="right">1618.394</td>
<td align="right">1324.9295</td>
<td align="right">1974.714</td>
<td align="right">1439.280</td>
<td align="right">1816.943</td>
</tr>
<tr class="even">
<td align="left">ft7_ges1resc</td>
<td align="right">2360.091</td>
<td align="right">1913.6245</td>
<td align="right">2904.107</td>
<td align="right">2088.122</td>
<td align="right">2661.336</td>
</tr>
</tbody>
</table>
<div id="b" class="section level3">
<h3>2B</h3>
<pre class="r"><code>daf7FISH&lt;-read.csv(&quot;extdata/2B_daf7FISH_4frames.csv&quot;) %&gt;%
  separate(Label, c(&quot;method&quot;,&quot;group&quot;,&quot;sample&quot;),sep = c(&quot;-&quot;), extra = &quot;drop&quot;) %&gt;%
  separate(sample, c(&quot;sample&quot;, &quot;type&quot;),sep =&quot;:&quot;, extra = &quot;drop&quot;) %&gt;%
  mutate(genotype = data.frame(do.call(rbind, strsplit(as.vector(group), split = &quot;daf7_mRNA_L1_27d_&quot;)))[,2]) %&gt;%
  mutate(ID = interaction(genotype, sample)) %&gt;%
  mutate(genotype = factor(genotype, levels = c(&quot;N2&quot;, &quot;ft7&quot;, &quot;mg360&quot;, &quot;mg360resc&quot;)))

#measured background fluorescence of each of 4 frames to normalize the sum projection of the neuron
#merge to add mean background value to each row:
background &lt;- filter(daf7FISH, type == &quot;background&quot;) %&gt;% dplyr::select(ID, mean)
colnames(background) &lt;- c(&quot;ID&quot;, &quot;background&quot;)

cells&lt;-dplyr::filter(daf7FISH, type == &quot;cell&quot;) %&gt;% dplyr::select(ID, sample, mean, genotype)
colnames(cells) &lt;- c(&quot;ID&quot;, &quot;sample&quot;, &quot;cell.mean&quot;, &quot;genotype&quot;)

daf7FISH &lt;- merge(cells, background,by=&quot;ID&quot;) %&gt;%
  mutate(cell.norm = cell.mean - mean(background), 
         cell.diffnorm = cell.mean - background,
         cell.ratioNorm = cell.mean / background)</code></pre>
<pre class="r"><code>#simple lm
lm&lt;-lm(data=daf7FISH, formula=cell.norm~genotype)
#check for outliers
daf7FISH &lt;- dauergut::flag_outliers(lm, daf7FISH, threshold = 4, noplot = TRUE)

lm.0&lt;-lm(data=daf7FISH[daf7FISH$outlier.status == FALSE,], formula=cell.norm~1)
lm.1&lt;-lm(data=daf7FISH[daf7FISH$outlier.status == FALSE,], formula=cell.norm~genotype)
#anova(lm.0, lm.1) p ~ 0.013

stanlm &lt;- stan_glm(cell.norm ~ genotype, data = daf7FISH[daf7FISH$outlier.status == FALSE,])</code></pre>
<pre><code>## 
## SAMPLING FOR MODEL &#39;continuous&#39; NOW (CHAIN 1).
## 
## Chain 1, Iteration:    1 / 2000 [  0%]  (Warmup)
## Chain 1, Iteration:  200 / 2000 [ 10%]  (Warmup)
## Chain 1, Iteration:  400 / 2000 [ 20%]  (Warmup)
## Chain 1, Iteration:  600 / 2000 [ 30%]  (Warmup)
## Chain 1, Iteration:  800 / 2000 [ 40%]  (Warmup)
## Chain 1, Iteration: 1000 / 2000 [ 50%]  (Warmup)
## Chain 1, Iteration: 1001 / 2000 [ 50%]  (Sampling)
## Chain 1, Iteration: 1200 / 2000 [ 60%]  (Sampling)
## Chain 1, Iteration: 1400 / 2000 [ 70%]  (Sampling)
## Chain 1, Iteration: 1600 / 2000 [ 80%]  (Sampling)
## Chain 1, Iteration: 1800 / 2000 [ 90%]  (Sampling)
## Chain 1, Iteration: 2000 / 2000 [100%]  (Sampling)
##  Elapsed Time: 0.109359 seconds (Warm-up)
##                0.08403 seconds (Sampling)
##                0.193389 seconds (Total)
## 
## 
## SAMPLING FOR MODEL &#39;continuous&#39; NOW (CHAIN 2).
## 
## Chain 2, Iteration:    1 / 2000 [  0%]  (Warmup)
## Chain 2, Iteration:  200 / 2000 [ 10%]  (Warmup)
## Chain 2, Iteration:  400 / 2000 [ 20%]  (Warmup)
## Chain 2, Iteration:  600 / 2000 [ 30%]  (Warmup)
## Chain 2, Iteration:  800 / 2000 [ 40%]  (Warmup)
## Chain 2, Iteration: 1000 / 2000 [ 50%]  (Warmup)
## Chain 2, Iteration: 1001 / 2000 [ 50%]  (Sampling)
## Chain 2, Iteration: 1200 / 2000 [ 60%]  (Sampling)
## Chain 2, Iteration: 1400 / 2000 [ 70%]  (Sampling)
## Chain 2, Iteration: 1600 / 2000 [ 80%]  (Sampling)
## Chain 2, Iteration: 1800 / 2000 [ 90%]  (Sampling)
## Chain 2, Iteration: 2000 / 2000 [100%]  (Sampling)
##  Elapsed Time: 0.104206 seconds (Warm-up)
##                0.089136 seconds (Sampling)
##                0.193342 seconds (Total)
## 
## 
## SAMPLING FOR MODEL &#39;continuous&#39; NOW (CHAIN 3).
## 
## Chain 3, Iteration:    1 / 2000 [  0%]  (Warmup)
## Chain 3, Iteration:  200 / 2000 [ 10%]  (Warmup)
## Chain 3, Iteration:  400 / 2000 [ 20%]  (Warmup)
## Chain 3, Iteration:  600 / 2000 [ 30%]  (Warmup)
## Chain 3, Iteration:  800 / 2000 [ 40%]  (Warmup)
## Chain 3, Iteration: 1000 / 2000 [ 50%]  (Warmup)
## Chain 3, Iteration: 1001 / 2000 [ 50%]  (Sampling)
## Chain 3, Iteration: 1200 / 2000 [ 60%]  (Sampling)
## Chain 3, Iteration: 1400 / 2000 [ 70%]  (Sampling)
## Chain 3, Iteration: 1600 / 2000 [ 80%]  (Sampling)
## Chain 3, Iteration: 1800 / 2000 [ 90%]  (Sampling)
## Chain 3, Iteration: 2000 / 2000 [100%]  (Sampling)
##  Elapsed Time: 0.101312 seconds (Warm-up)
##                0.093036 seconds (Sampling)
##                0.194348 seconds (Total)
## 
## 
## SAMPLING FOR MODEL &#39;continuous&#39; NOW (CHAIN 4).
## 
## Chain 4, Iteration:    1 / 2000 [  0%]  (Warmup)
## Chain 4, Iteration:  200 / 2000 [ 10%]  (Warmup)
## Chain 4, Iteration:  400 / 2000 [ 20%]  (Warmup)
## Chain 4, Iteration:  600 / 2000 [ 30%]  (Warmup)
## Chain 4, Iteration:  800 / 2000 [ 40%]  (Warmup)
## Chain 4, Iteration: 1000 / 2000 [ 50%]  (Warmup)
## Chain 4, Iteration: 1001 / 2000 [ 50%]  (Sampling)
## Chain 4, Iteration: 1200 / 2000 [ 60%]  (Sampling)
## Chain 4, Iteration: 1400 / 2000 [ 70%]  (Sampling)
## Chain 4, Iteration: 1600 / 2000 [ 80%]  (Sampling)
## Chain 4, Iteration: 1800 / 2000 [ 90%]  (Sampling)
## Chain 4, Iteration: 2000 / 2000 [100%]  (Sampling)
##  Elapsed Time: 0.111333 seconds (Warm-up)
##                0.086007 seconds (Sampling)
##                0.19734 seconds (Total)</code></pre>
<pre class="r"><code>strains &lt;- levels(daf7FISH$genotype)
contrasts &lt;- dauergut::dunnett_contrasts(lm.1,ref.index = 1,&quot;genotype&quot;)</code></pre>
<pre><code>## [1] &quot;interaction term not indicated&quot;</code></pre>
<pre class="r"><code>mixed &lt;- stanlm %&gt;% dauergut::getStan_CIs()
rescue.test &lt;- daf7FISH[daf7FISH$outlier.status == FALSE,] %&gt;% subset(genotype %in% c(&quot;mg360&quot;, &quot;mg360resc&quot;)) %$% t.test(cell.norm ~ genotype)
rescue.p &lt;- data.frame(p.value = rescue.test$p.value) %&gt;% dauergut::prange()

plot.contrasts &lt;- c(&quot;&quot;, contrasts$prange[1:2],&quot;&quot;)
plot.contrasts.2 &lt;- c(&quot;&quot;, &quot;&quot;, &quot;&quot;, rescue.p$prange)

dauergut::plot_CIs(daf7FISH[daf7FISH$outlier.status == FALSE,], title = &quot;daf7 mRNA is reduced in rict-1 mutants&quot;, plot.contrasts = plot.contrasts, plot.contrasts.2 = plot.contrasts.2, ypos = 150, offset = 0, type = &quot;expression&quot;)</code></pre>
<p><img src="Figure_2_files/figure-html/plot%20daf7FISH-1.png" width="672" /></p>
<p>2B. <em>Daf-7</em> mRNA is reduced in <em>rict-1</em> mutants. Animals were grown 18hrs post egg lay at 27ยบ, then fixed prior to FISH. Intestinal expression of <em>rict-1</em> using the intestinal <em>ges-1</em> promoter rescues <em>daf-7</em> expression. Box and scatter plot show raw data. Bayesian 90% (grey) and 50% (red) credible intervals are shown on the right (see methods). For <em>rict-1(mg360)</em> and <em>rict-1(ft7)</em>, p~0.04 and p~0.032 compared to N2, respectively. For <em>ges-1</em> rescue, p~0.038 compared to <em>rict-1(ft7)</em>. n=2 independent experiments, pooled data. 2 outlier data points were removed in total.</p>
<!-- ###2C  -->
<!-- rescue of rict-1 with daf-7 and daf-28 -->
<!-- ```{r daf7/daf28 suppress rict-1} -->
<!-- strains<-c("N2","rict-1(ft7)","rict-1(ft7); ex[ASI::daf7]","rict-1(ft7); ex[ASI::daf28]","rict-1(ft7); ex[ASJ::daf28]") -->
<!-- daf7supp<-read.csv(file.path(pathname, "extdata/2C_daf7_daf28_suppression.csv")) %>% format_dauer(p.dauer = "non") -->
<!-- # daf7supp$genotype<- factor(daf7supp$genotype, levels = strains) -->
<!-- # daf7supp$pct<-as.numeric(paste(daf7supp$dauer/(daf7supp$dauer+daf7supp$pd + daf7supp$non))) #omitted arrest -->
<!-- # daf7supp$non.dauer<-as.numeric(paste(daf7supp$pd+daf7supp$non)) -->
<!-- lm <- daf7supp %>% dauer_ANOVA() -->
<!-- #stan -->
<!-- stan.glmm <- daf7supp %>% dauergut::run_dauer_stan() -->
<!-- ``` -->
<!-- ```{r daf7/daf28 suppression plot, fig.width=4} -->
<!-- foods <- "OP50" -->
<!-- contrasts<-dauergut::tukey_contrasts(lm, "genotype") -->
<!-- mixed<-stan.glmm %>% dauergut::getStan_CIs(type = "dauer") -->
<!-- plot.contrasts<-c("",contrasts$prange[1],"","","") -->
<!-- plot.contrasts.2<-c("", "", contrasts$prange[5:7]) #for rescue vs rict-1 -->
<!-- (p<-dauergut::plot_CIs(daf7supp, title='daf-7 expression in ASI suppresses rict-1 dauer phenotype', plot.contrasts, plot.contrasts.2, ypos = 1.075, offset = 0, type = "dauer")) -->
<!-- ``` -->
<!-- ###2D -->
<!-- ```{r load daf28GFP data} -->
<!-- #days = as.factor(8:10) # days containing N2 and ft7 27ยบ data -->
<!-- days = as.factor(8:10) -->
<!-- strains = c("N2", "ft7") -->
<!-- foods = "OP50" -->
<!-- d28<-read.csv('extdata/2D_3B_daf-28_GFP_rict-1.csv') %>% -->
<!-- separate(ID, c("ID.A", "ID.B"), sep = ":", extra = "drop") %>% -->
<!--   subset(mean!=4095 & food == foods & temp == "27" & genotype %in% strains & pheromone == 0) %>%  -->
<!--   mutate(day = as.factor(day), genotype = factor(genotype, levels = strains), -->
<!--          genoID = interaction(date,genotype, ID.A)) -->
<!-- df <- d28 %>% subset(day %in% days) %>% group_by(date,genotype,neuron,genoID) %>% summarise(cell.norm = mean(mean)) %>% -->
<!--   data.frame() %>% mutate(group.id = interaction(genotype, neuron)) # take mean of each worm -->
<!-- ``` -->
<!-- ```{r daf28 rict-1 plot, warning=FALSE, fig.width=8} -->
<!-- #fit simple linmod to est outliers: -->
<!-- lm1 <- with(log.tran, lm(linkfun(cell.norm) ~ neuron * genotype, data = df)) -->
<!-- df %<>% flag_outliers(lin.mod=lm1, threshold = 4, df = .) -->
<!-- #df.ASI <- df %>% dplyr::filter(neuron == "ASI") -->
<!-- #df.ASJ <- df %>% dplyr::filter(neuron == "ASJ") -->
<!-- # linear MM -->
<!-- library(lsmeans) -->
<!-- log.tran<-make.tran(type="genlog", param = c(0,10)) #make log10 transformation -->
<!-- #lmm.ASI <- with(log.tran, lmer(linkfun(cell.norm) ~ neuron * genotype + (1|neuron:date) + (1|genotype:neuron:date), data = df.ASI[df$outlier.status==FALSE,])) -->
<!-- #lmm.ASJ <- with(log.tran, lmer(linkfun(cell.norm) ~ neuron * genotype + (1|neuron:date) + (1|genotype:neuron:date), data = df.ASJ[df$outlier.status==FALSE,])) -->
<!-- lm <- with(log.tran, lm(linkfun(cell.norm) ~ neuron * genotype, data = df[df$outlier.status==FALSE,])) -->
<!-- stanlmer <- with(log.tran, stan_lmer(linkfun(cell.norm) ~ 1 + group.id + (1|date) + (1:group.id:date), data = df)) -->
<!-- with(df[df$neuron == "ASI" & df$outlier.status == FALSE,], with(log.tran, t.test(cell.norm ~genotype))) -->
<!-- with(df[df$neuron == "ASJ" & df$outlier.status == FALSE,], with(log.tran, t.test(cell.norm ~genotype))) -->
<!-- contrasts<-summary(lsmeans(lm, pairwise ~ genotype | neuron)$contrasts) %>% dauergut::prange() -->
<!-- mixed <- stanlmer %>% getStan_CIs(type = "log", group = "neuron", base = 10, compare_gt = TRUE) -->
<!-- plot.contrasts<-c("",contrasts$prange[1],"", contrasts$prange[2]) -->
<!-- #### plot ###### -->
<!-- p<-(df %>% ggplot(aes(x=genotype, y = cell.norm)) + -->
<!--   #### plot raw data and quartiles   -->
<!--           geom_quasirandom(aes(y=cell.norm, pch = date),cex=1,colour = "#339900", -->
<!--                            width = 0.075,size=0.3, -->
<!--                            method = 'smiley') + -->
<!--     guides(pch=FALSE) + -->
<!--     list(add.median(width = 0.25), add.quartiles()) + -->
<!-- labs(title = "daf-28 is also reduced in rict-1 mutants", -->
<!--      subtitle = "GFP plot", -->
<!--            y = "mean GFP intensity", x="genotype") + -->
<!--   #### plot Bayesian credible intervals -->
<!--   stat_summary(aes(x=genotype, group = genotype, y = 3500), geom="text", fun.data=box_annot, label=plot.contrasts, size = 6) + -->
<!--   geom_errorbar(data=mixed, aes(x=x.pos,y=mean, ymin=lower.CL, ymax=upper.CL), -->
<!--                   width=0,colour ="grey", lwd=0.2) + #90% cred int for 95% one-sided H0 -->
<!--   geom_errorbar(data=mixed, aes(x=x.pos,y=mean, ymin = lower.25, ymax = upper.75), -->
<!--                   width=0,colour = "darkgrey", lwd = 0.9) + #75% cred interval -->
<!--       geom_segment(data = mixed, aes(x = x.pos-(0.007*nrow(mixed)), y = mean, xend = x.pos+(0.007*nrow(mixed)), yend = mean), colour = "darkgrey") +  -->
<!--   stat_summary(aes(x=as.numeric(as.factor(genotype)) + 0.3,y=0,group = genotype), -->
<!--                fun.data = fun_length, geom = "text",size = 4) + -->
<!--   facet_grid(.~neuron, switch="both") + theme_my + -->
<!--   theme(axis.text.y = element_text(size=12), -->
<!--         axis.text.x = element_text(size = 16), -->
<!--         axis.title = element_text(size=16), -->
<!--         panel.spacing.x=unit(2,"lines"))) -->
<!-- # knitr::kable(summary(lsmeans(lm3, pairwise ~ genotype | neuron, type = "response"))$contrasts) -->
<!-- ``` -->
<!-- ###S1A -->
<!-- ```{r daf-16 suppresion} -->
<!-- strains<-c("N2","rict-1(mg360)","rict-1;daf-16") -->
<!-- foods <- "OP50" -->
<!-- daf16supp<-read.csv(file.path(pathname, "extdata/S1A_daf16_suppression.csv")) %>% format_dauer(.,p.dauer = "dauer") -->
<!-- # daf28supp$genotype<- factor(daf28supp$genotype, levels = strains) -->
<!-- # daf28supp$pct<-as.numeric(paste(daf28supp$dauer/(daf28supp$dauer+daf28supp$pd + daf28supp$non))) #omitted arrest -->
<!-- # daf28supp$non.dauer<-as.numeric(paste(daf28supp$pd+daf28supp$non)) -->
<!-- lm <- daf16supp %>% dauer_ANOVA() -->
<!-- #stan -->
<!-- stan.glmm <- daf16supp %>% stan_glmer(formula = cbind((dauer+pd), (n-(dauer+pd))) ~ genotype + (1|day) + (1|strainDate) + (1|plateID), -->
<!--                        data=., -->
<!--                        family = binomial(link="logit"), -->
<!--                        chains = 3, cores =4, seed = 2000,iter=6000, -->
<!--                        control = list(adapt_delta=0.99)) -->
<!-- ``` -->
<!-- ```{r daf-16 suppression plot} -->
<!-- contrasts<-dauergut::tukey_contrasts(lm, "genotype") -->
<!-- mixed<-stan.glmm %>% getStan_CIs(type="dauer") -->
<!-- plot.contrasts<-c("",contrasts$prange[1],"") -->
<!-- plot.contrasts.2<-c("", "", contrasts$prange[3]) #for rescue vs rict-1 -->
<!-- (p<-dauergut::plot_CIs(daf16supp, title='rict-1 acts in the insulin pathway to inhibit dauer formation', plot.contrasts, plot.contrasts.2, ypos = 1.075, offset = 0, type = "dauer")) -->
<!-- ``` -->
<!-- ###S1B -->
<!-- ```{r rict-1 pheromone response} -->
<!-- strains <- c("N2", "rict-1(ft7)") -->
<!-- foods <- "OP50" -->
<!-- rictC3 <- read.csv(file.path(pathname, 'extdata/S3C_rict1Pheromone.csv')) %>% format_dauer(p.dauer = "exclude") %>% mutate(plateID = interaction(plateID,concentration.uM.)) -->
<!-- glm <- glm(data = rictC3, cbind(dauer, non) ~ concentration.uM. * genotype, family = binomial) -->
<!-- glmm <- glmer(data = rictC3, cbind(dauer, non) ~ concentration.uM. + genotype + (1|day/plateID), family = binomial) -->
<!-- brms.glmm <- brms::brm(data = rictC3, formula= dauer | trials(n) ~ concentration.uM. + genotype + (1|plateID), family = binomial) -->
<!-- newdata = data.frame(genotype = rep(strains, each = 241), concentration.uM. = rep(seq(0,2.4, by = 0.01),2),plateID = rep(0, 482), n = rep(60, 482)) -->
<!-- predictions <- predict(glm, newdata = newdata, type = "response", se.fit = TRUE) -->
<!-- glmm.predict <- predict(glmm,newdata=newdata,type = "response", re.form = NA) #re.form = ~0) -->
<!-- brms.predict <- predict(brms.glmm,newdata=newdata,type = "response", re.form = NA, allow_new_levels = TRUE) -->
<!-- newdata1 <- cbind(newdata, predictions) -->
<!-- newdata1 %<>% mutate(lower = (fit - se.fit), upper = (fit + se.fit), pct = fit) -->
<!-- newdata2 <- cbind(newdata, glmm.predict) %>% mutate(pct = glmm.predict) -->
<!-- newdata3 <- cbind(newdata, brms.predict) %>% mutate(pct = Estimate/n) -->
<!-- #newdata3 <- effects::effect(newdata, glmm) -->
<!-- #get odds-ratio -->
<!-- mfx::logitor(glm, data = rictC3) # OR ~ 21.3  -->
<!-- (p<-rictC3 %>% ggplot(aes(x=concentration.uM.,y = pct)) + -->
<!--   geom_ribbon(data = newdata1,aes(ymin=lower, ymax=upper,fill=genotype), alpha=0.3) +  -->
<!--   geom_line(data = newdata2,aes(x = concentration.uM., y = pct),colour = "red") + -->
<!--     geom_line(data = newdata3,aes(x = concentration.uM., y = pct), colour = "green") + -->
<!--   geom_point(aes(y=pct), size = 0.6, alpha = 0.75, width = 0.05) + -->
<!--   add.median.dauer() + -->
<!--   #geom_line(data = newdata2,aes(x = concentration.uM., y = pct), colour = "green") +  -->
<!--   labs(y = "proportion dauer") + -->
<!--   facet_grid(.~genotype) + -->
<!--   scale_fill_manual(values = c("grey", "lightblue")) + -->
<!--   scale_colour_manual(values = c("grey", "lightblue")) + -->
<!--   geom_text(aes(y = 1.075, x=concentration.uM.), label = "") + -->
<!--     coord_cartesian(ylim = c(-.005,1.075)) + -->
<!--       scale_y_continuous(breaks=c(0,0.25,0.5,0.75,1)) + -->
<!--   theme_my_classic +  -->
<!--   theme(#axis.title.x = element_blank(), -->
<!--         axis.text.x = element_blank(), -->
<!--         axis.text.y = element_text(size=16), -->
<!--         axis.title.y = element_text(size =20), -->
<!--         strip.text.x = element_blank(), -->
<!--         panel.spacing = unit(2,"lines")) +  -->
<!--     stat_summary(aes(x=concentration.uM. + 0.3, y=-.025), -->
<!--                       fun.data = fun_length, geom = "text", size = 4) -->
<!-- ) -->
<!-- ``` -->
</div>
</div>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
